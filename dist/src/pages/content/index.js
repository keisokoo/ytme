var O=Object.defineProperty;var H=(i,t,e)=>t in i?O(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>(H(i,typeof t!="symbol"?t+"":t,e),e);class V{constructor(t,e,s){o(this,"factor",.05);o(this,"minScale",.1);o(this,"maxScale",10);o(this,"ts",{scale:1,rotate:0,translate:{x:0,y:0}});o(this,"filter",{contrast:1,saturate:1,brightness:1});o(this,"loopTime",{start:null,end:null});o(this,"restrictPosition");o(this,"before");o(this,"after");o(this,"restrictXY",t=>{let{x:e,y:s}=t;if(!this.targetElement)return{x:e,y:s};if(!this.restrictPosition)return{x:e,y:s};const n=this.targetElement.getBoundingClientRect();return this.restrictPosition(t,n)});o(this,"decompose_2d_matrix",t=>{const{a:e,b:s,c:n,d:a,e:c,f:d}=t;let f=e*a-s*n,r={translation:[c,d],deg:0,rotation:0,scale:[0,0],skew:[0,0]};if(e!==0||s!==0){let u=Math.sqrt(e*e+s*s);r.rotation=s>0?Math.acos(e/u):-Math.acos(e/u),r.scale=[u,f/u],r.skew=[Math.atan((e*n+s*a)/(u*u)),0]}else if(n!==0||a!==0){let u=Math.sqrt(n*n+a*a);r.rotation=Math.PI/2-(a>0?Math.acos(-n/u):-Math.acos(n/u)),r.scale=[f/u,u],r.skew=[0,Math.atan((e*n+s*a)/(u*u))]}Math.abs(r.rotation)===0&&(r.rotation=0);const m=r.rotation*(180/Math.PI);return r.deg=m<0?m+360:m,{scale:r.scale[0],rotate:r.deg,translate:{x:r.translation[0],y:r.translation[1]}}});o(this,"isTranslateValues",t=>t!==void 0&&"translate"in t&&"rotate"in t&&"scale"in t);o(this,"isFilter",t=>t!==void 0&&"contrast"in t&&"brightness"in t&&"saturate"in t);o(this,"getPosition",t=>{const e=new WebKitCSSMatrix(window.getComputedStyle(t??this.targetElement).transform);return this.decompose_2d_matrix(e)});o(this,"updatePosition",t=>{this.isTranslateValues(t)?this.ts=t:this.ts=t(this.getPosition()),this.setTransform()});o(this,"loadTransform",()=>{const t=localStorage.getItem("ytf-transform"),e=localStorage.getItem("ytf-filter");if(t){const s=JSON.parse(t);this.isTranslateValues(s)&&(this.ts=s,this.setTransform())}if(e){const s=JSON.parse(e);this.isFilter(s)&&(this.filter=s,this.setFilter())}});o(this,"setTransform",()=>{this.before&&this.before(),localStorage.setItem("ytf-transform",JSON.stringify(this.ts)),this.targetElement.style.transform=`translate(${this.ts.translate.x}px,${this.ts.translate.y}px) scale(${this.ts.scale}) rotate(${this.ts.rotate}deg)`,this.after&&this.after()});o(this,"setFilter",()=>{this.before&&this.before(),localStorage.setItem("ytf-filter",JSON.stringify(this.filter)),Object.keys(this.filter).forEach(t=>{const e=document.querySelector(`.ytf-${t}`);e&&(e.textContent=String(Math.floor(this.filter[t]*100)/100))}),this.targetElement.style.filter=`contrast(${this.filter.contrast}) saturate(${this.filter.saturate}) brightness(${this.filter.brightness})`,this.after&&this.after()});o(this,"toggleRotation",t=>(t=Math.abs(t),t===0?90:t===90?180:t===180?270:0));this.targetElement=t,this.eventElement=e,s!=null&&s.factor&&(this.factor=s.factor),s!=null&&s.minScale&&(this.minScale=s.minScale),s!=null&&s.maxScale&&(this.maxScale=s.maxScale),s!=null&&s.before&&(this.before=s.before),s!=null&&s.after&&(this.after=s.after),s!=null&&s.restrictPosition&&(this.restrictPosition=s.restrictPosition)}}class z extends V{constructor(){super(...arguments);o(this,"inertiaAnimationFrame",-1);o(this,"isDrag",!1);o(this,"isScale",!1);o(this,"dragged",!1);o(this,"threshold",1);o(this,"startPoint",{x:0,y:0});o(this,"previousPosition",{x:0,y:0});o(this,"maximumInertia",40);o(this,"velocity",{x:0,y:0});o(this,"deceleration",.9);o(this,"startDist",0);o(this,"startScale",1);o(this,"capSpeed",e=>{let s=0;return Math.abs(e)>this.maximumInertia?(s=this.maximumInertia,s*=e<0?-1:1,s):e});o(this,"updateInertia",()=>{this.targetElement&&(this.velocity.x=this.velocity.x*this.deceleration,this.velocity.y=this.velocity.y*this.deceleration,this.velocity.x=Math.round(this.velocity.x*10)/10,this.velocity.y=Math.round(this.velocity.y*10)/10,this.ts.translate.x=Math.round(this.ts.translate.x+this.velocity.x),this.ts.translate.y=Math.round(this.ts.translate.y+this.velocity.y),this.setTransform(),(Math.floor(Math.abs(this.velocity.x))!==0||Math.floor(Math.abs(this.velocity.y))!==0)&&(this.inertiaAnimationFrame=requestAnimationFrame(this.updateInertia)))});o(this,"dragFinish",()=>{this.velocity={x:this.capSpeed(this.restrictXY(this.velocity).x),y:this.capSpeed(this.restrictXY(this.velocity).y)},(this.velocity.x!==0||this.velocity.y!==0)&&(this.inertiaAnimationFrame=requestAnimationFrame(this.updateInertia))})}}const B=[0,90,180,270],Q=i=>{const t=B.length-1;return i+1>t?0:B[i+1]};class C extends z{constructor(){super(...arguments);o(this,"isPlaying",!1);o(this,"bezelTimeout");o(this,"key",e=>{if(e.code==="KeyR"){this.ts=this.getPosition();const s=this.ts.rotate,n=B.findIndex(a=>a===s);this.ts={...this.ts,rotate:Q(n)},this.setTransform()}});o(this,"hasTransformed",()=>this.ts.rotate!==0||this.ts.scale!==1||this.ts.translate.x!==0||this.ts.translate.y!==0);o(this,"restore",()=>{this.ts={rotate:0,scale:1,translate:{x:0,y:0}},this.setTransform()});o(this,"on",e=>{const s=localStorage.getItem("ytme-move");if(!s||s==="false")return;const n=document.querySelector("video");if(n&&(this.isPlaying=!n.paused),e.button)return e.preventDefault!=null&&e.preventDefault(),e.stopPropagation!=null&&e.stopPropagation(),this.restore(),e.cancelBubble=!1,!1;this.ts=this.getPosition(),this.isTouchEvent(e)&&e.touches.length===2?(this.isDrag=!1,this.isScale=!0,this.startDist=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY),this.startScale=this.ts.scale):(cancelAnimationFrame(this.inertiaAnimationFrame),this.isDrag=!0,this.isScale=!1,this.startPoint={x:this.isTouchEvent(e)?e.touches[0].pageX:e.pageX,y:this.isTouchEvent(e)?e.touches[0].pageY:e.pageY},this.previousPosition={x:this.ts.translate.x,y:this.ts.translate.y},this.velocity={x:0,y:0});const a=this.eventElement??this.targetElement;e.touches?(a.addEventListener("touchmove",this.onMove,{passive:!0}),a.addEventListener("touchend",this.onEnd)):(a.addEventListener("mousemove",this.onMove,{passive:!0}),a.addEventListener("mouseup",this.onEnd),a.addEventListener("mouseleave",this.onEnd))});o(this,"isTouchEvent",e=>"touches"in e);o(this,"onMove",e=>{if(!this.targetElement)return;let s=this.eventElement?this.eventElement.ontouchmove:this.targetElement.ontouchmove;if(this.targetElement.ontouchmove=null,this.isDrag&&(this.isTouchEvent(e)&&e.touches.length===1||!this.isTouchEvent(e))){const n=this.isTouchEvent(e)?e.touches[0].pageX:e.pageX,a=this.isTouchEvent(e)?e.touches[0].pageY:e.pageY,c=this.ts.translate.x,d=this.ts.translate.y,f=-1;if(this.ts.translate.x=this.previousPosition.x+f*(-n+this.startPoint.x),this.ts.translate.y=this.previousPosition.y+f*(-a+this.startPoint.y),this.ts.translate=this.restrictXY(this.ts.translate),this.setTransform(),this.velocity={x:this.ts.translate.x-c,y:this.ts.translate.y-d},Math.abs(this.previousPosition.x-this.ts.translate.x)>this.threshold||Math.abs(this.previousPosition.y-this.ts.translate.x)>this.threshold){this.dragged=!0,document.body&&document.body.setAttribute("ytme-hide","");const r=document.querySelector("video");r&&(clearTimeout(this.bezelTimeout),this.isPlaying?(r.onpause=null,r.onpause=()=>{r.paused&&r.play().then(()=>{r.paused&&r.play()}),r.onpause=null,this.bezelTimeout=setTimeout(()=>{document.body&&document.body.removeAttribute("ytme-hide")},350)}):(r.onplay=null,r.onplay=()=>{r.paused||r.pause(),r.onplay=null,this.bezelTimeout=setTimeout(()=>{document.body&&document.body.removeAttribute("ytme-hide")},350)}))}}else if(this.isScale&&this.isTouchEvent(e)&&e.touches.length===2){const n=e.touches[0],a=e.touches[1],c=Math.hypot(n.clientX-a.clientX,n.clientY-a.clientY);let d=this.targetElement.getBoundingClientRect(),f=((n.clientX+a.clientX)/2-d.left)/this.ts.scale,r=((n.clientY+a.clientY)/2-d.top)/this.ts.scale;const m={w:Math.round(d.width/this.ts.scale),h:Math.round(d.height/this.ts.scale)},u=Math.hypot(m.w*this.ts.scale,m.h*this.ts.scale),T=u*c/this.startDist/u*this.startScale,Y=Math.min(Math.max(this.minScale,T),this.maxScale),w=Y-this.ts.scale,x=(w>0,w/2);this.ts.translate.x+=-(f*x*2)+m.w*x,this.ts.translate.y+=-(r*x*2)+m.h*x,this.ts.translate=this.restrictXY(this.ts.translate),this.ts.scale=Y,this.setTransform()}this.eventElement?this.eventElement.ontouchmove=s:this.targetElement.ontouchmove=s});o(this,"onEnd",e=>{const s=this.eventElement??this.targetElement;this.isTouchEvent(e)?(s.removeEventListener("touchmove",this.onMove),s.removeEventListener("touchend",this.onEnd)):(s.removeEventListener("mousemove",this.onMove),s.removeEventListener("mouseup",this.onEnd),s.removeEventListener("mouseleave",this.onEnd)),cancelAnimationFrame(this.inertiaAnimationFrame),this.dragged&&this.isDrag&&this.dragFinish(),this.dragged=!1,this.isDrag=!1,this.isScale=!1});o(this,"onWheel",e=>{const s=localStorage.getItem("ytme-move");if(!s||s==="false"||!this.targetElement)return;e.preventDefault(),this.ts=this.getPosition();let n=this.eventElement?this.eventElement.onwheel:this.targetElement.onwheel;this.targetElement.onwheel=null;let a=this.targetElement.getBoundingClientRect(),c=(e.clientX-a.left)/this.ts.scale,d=(e.clientY-a.top)/this.ts.scale,f=-e.deltaY;if(this.ts.scale===this.maxScale&&f>0)return;const r={w:Math.round(a.width/this.ts.scale),h:Math.round(a.height/this.ts.scale)},m=this.factor*this.ts.scale;this.ts.scale=f>0?this.ts.scale+m:this.ts.scale-m,this.ts.scale=Math.min(Math.max(this.minScale,this.ts.scale),this.maxScale);let u=f>0?m/2:-(m/2);this.ts.scale<=this.minScale&&f<0||(this.ts.translate.x+=-c*u*2+r.w*u,this.ts.translate.y+=-d*u*2+r.h*u,this.ts.translate=this.restrictXY(this.ts.translate),this.setTransform(),this.eventElement?this.eventElement.onwheel=n:this.targetElement.onwheel=n)})}}let v,g=!1,I=!1,l=null,L,p=null,y=null,h={},b=!1;const S=i=>new Promise(t=>setTimeout(t,i)),F=i=>{if(!Number(i)||!i)return"00:00";let t=Number(i.toFixed(0)),e=Math.floor(t/3600),s=Math.floor((t-e*3600)/60),n=t-e*3600-s*60,a=i-Math.floor(i);return`${e?String(e).padStart(2,"0")+":":""}${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}${a?Math.abs(a).toFixed(2).replace("0.","."):""}`},M=i=>/(.*?)(^|\/|v=)([a-z0-9_-]{11})(.*)?/gim.test(i??window.location.href),J=()=>document.body.setAttribute("ytme",""),U=()=>document.body.removeAttribute("ytme");async function X(){let i=document.querySelector("video");for(;!i;)await S(300),i=document.querySelector("video")}const W=["4320p","2880p","2160p","1440p","1080p","720p","480p","360p","240p","144p"];function _(i){const t=/(^\d.*)p/g,e=/\((.*[0-9])p/g;return i.filter(n=>{let a=n==null?void 0:n.innerText.trim();return!e.test(a)&&(W.some(c=>a.includes(c))||t.test(a))})}async function k(){var e;if(g=!0,localStorage.getItem("ytme-hq")!=="true")return;await X();let t=(e=document.getElementsByClassName("ytp-settings-button"))==null?void 0:e[0];await S(300),t&&t.click()}function G(i){i==null||i.disconnect(),l==null||l.loadTransform()}const $=()=>{const i=document.querySelectorAll(".ytme-btn");i.length>0&&i.forEach(t=>t.remove())},K=i=>{const t=document.createElement("button"),e=document.createElement("span");return t.classList.add("ytp-button"),t.classList.add("ytme-btn"),t.classList.add("ytme-text-btn"),e.innerText=i,t.appendChild(e),{button:t,span:e}},j=(i,t)=>{const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS(null,"width","100%"),e.setAttributeNS(null,"height","100%"),e.setAttributeNS(null,"version","1.1"),e.setAttributeNS(null,"viewBox","0 0 36 36");const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"fill","#ffffff"),s.setAttributeNS(null,"d",i);const n=document.createElement("button");return n.classList.add("ytp-button"),n.classList.add("ytme-btn"),t&&n.classList.add(t),e.appendChild(s),n.appendChild(e),n},Z=(i,t)=>{localStorage.getItem(i)==="true"?t.classList.add("active"):t.classList.remove("active")},tt=()=>typeof(h==null?void 0:h.A)=="number"&&typeof(h==null?void 0:h.B)=="number"&&h.A<h.B,R=i=>{const t=i.currentTarget;b&&typeof h.A=="number"&&typeof h.B=="number"&&(t.currentTime<h.A||t.currentTime>h.B)&&(t.pause(),t.currentTime=h.A,t.play())},et=i=>{const t=i.target;if(t.classList.contains("ytme-inner-btn")){i.stopPropagation();const n=document.querySelector("video");if(!n)return;const a=t.classList.contains("ytme-a"),c=t.classList.contains("ytme-b"),d=t.classList.contains("ytme-toggle-a-b");if(a)if(h.A)h.A=void 0,t.innerText="A";else{if(h.B&&n.currentTime>h.B)return;h.A=n.currentTime,t.innerText=`A: ${F(h.A)}`}if(c)if(h.B)h.B=void 0,t.innerText="B";else{if(h.A&&n.currentTime<h.A)return;h.B=n.currentTime,t.innerText=`B: ${F(h.B)}`}d&&(tt()?b=!b:b=!1,t.innerText=b?"on":"off",b?n.addEventListener("timeupdate",R):n.removeEventListener("timeupdate",R))}i.stopPropagation();const e=i.target;if(!e)return;const s=e.getAttribute("data-value");if(s){if(s==="rotate"&&(l.ts=l.getPosition(),l.ts={...l.ts,rotate:l.toggleRotation(l.ts.rotate)},e.innerText=`Rotate: ${l.ts.rotate+"°"}`,l.setTransform()),s==="hq"){const n=localStorage.getItem("ytme-hq");!n||n==="false"?(localStorage.setItem("ytme-hq","true"),e.classList.add("active")):(localStorage.setItem("ytme-hq","false"),e.classList.remove("active"))}if(s==="transform"){const n=localStorage.getItem("ytme-move");!n||n==="false"?(localStorage.setItem("ytme-move","true"),e.classList.add("active")):(localStorage.setItem("ytme-move","false"),e.classList.remove("active"))}}},st=()=>{const i=document.createElement("div");i.classList.add("ytme-option-list"),l.ts=l.getPosition();const t=localStorage.getItem("ytme-move")==="true",e=localStorage.getItem("ytme-hq")==="true";return i.innerHTML=`
  <div class="option-nav">
  <div class="option-item noPadding ytme-column" data-value="a-b">
    <div class="ytme-inner-btn noHover">Repeat</div>
    <div class="ytme-row ytme-group"><div class="ytme-a ytme-inner-btn">A</div><div class="ytme-b ytme-inner-btn">B</div><div class="ytme-toggle-a-b ytme-inner-btn">on/off</div></div>
  </div>
  <div class="option-item" data-value="rotate">Rotate: ${l.ts.rotate+"°"}</div>
  <div class="option-item${t?" active":""}" data-value="transform">Transform<div class="ytme-ball"></div></div>
  <div class="option-item${e?" active":""}" data-value="hq">Force High Quality<div class="ytme-ball"></div></div>
    </div>
  `,i},it=()=>{var s,n;if($(),!l)return;const i=j("M20.673,16.932l4.276,-0c0.445,-0 0.802,-0.358 0.802,-0.803l0,-4.275c0,-0.325 -0.193,-0.619 -0.494,-0.742c-0.301,-0.124 -0.645,-0.058 -0.876,0.174l-1.389,1.389c-2.927,-2.889 -7.641,-2.879 -10.551,0.033c-2.922,2.924 -2.922,7.661 0,10.584c2.924,2.923 7.661,2.923 10.584,-0c0.417,-0.418 0.417,-1.096 -0,-1.514c-0.418,-0.417 -1.096,-0.417 -1.513,0c-2.088,2.088 -5.473,2.088 -7.561,0c-2.087,-2.088 -2.087,-5.472 0,-7.56c2.078,-2.078 5.436,-2.088 7.527,-0.033l-1.373,1.376c-0.231,0.231 -0.297,0.575 -0.173,0.876c0.123,0.301 0.417,0.495 0.741,0.495Z","ytme-restore");l.ts=l.getPosition();const{button:t}=K("YT"),e=l.hasTransformed();Z("ytme-options",t),t.onclick=a=>{if(t.querySelector(".ytme-option-list"))t.classList.remove("active"),t.querySelector(".ytme-option-list").remove();else{t.classList.add("active");const c=st(),d=document.querySelector(".ytp-chrome-controls");c.style.bottom=d.clientHeight+8+"px";const f=t.getBoundingClientRect();c.style.left=f.left-16+"px",[...c.children].forEach(m=>m.addEventListener("click",et)),t==null||t.prepend(c)}},e&&i.classList.add("hide"),i.onclick=a=>{a.stopPropagation();const c=document.querySelector('.option-item[data-value="rotate"]');c&&(c.innerText=`Rotate: ${0+"°"}`),l.restore()},(s=document.querySelector(".ytp-right-controls"))==null||s.prepend(t),(n=document.querySelector(".ytp-right-controls"))==null||n.prepend(i)},D=()=>{document.querySelector("#masthead-container").classList.add("active")},E=()=>{document.querySelector("#masthead-container").classList.remove("active")},A=async(i,t,e)=>{var s;if(J(),await X(),y=document.querySelector("video:not(#video-preview-container video)"),y||(y=document.querySelector("video:not(#video-preview-container video)")),!p){if(!y||!y.parentElement)return;p=y.parentElement}if(!(l instanceof C)){l=new C(y,p,{before:()=>{i.disconnect()},after:()=>{const a=l.hasTransformed(),c=document.querySelector(".ytme-restore");a?c&&c.classList.remove("hide"):c&&c.classList.add("hide"),i.observe(t,e)}});const n=document.querySelector("#masthead-container");window.addEventListener("blur",a=>{E(),console.log("window blur")}),n.addEventListener("mouseenter",D),(s=document.querySelector(".ytp-overlay"))==null||s.addEventListener("mouseenter",()=>{console.log("ytp-overlay mouseenter"),E()}),y.addEventListener("mouseenter",a=>{console.log("currentVideo mouseenter"),E()}),y.addEventListener("mousedown",l.on),p.addEventListener("wheel",l.onWheel),it()}!g&&localStorage.getItem("ytme-hq")==="true"&&await k()},q=()=>{if(l){const i=document.querySelector("#masthead-container");i==null||i.removeEventListener("mouseenter",D),y==null||y.removeEventListener("mousedown",l.on),y==null||y.addEventListener("mouseenter",E),p==null||p.removeEventListener("wheel",l.onWheel),l=null}$(),U()};async function nt(){var t;await S(100);const i=(t=document.querySelector(".ytp-panel-menu"))==null?void 0:t.lastChild;if(i&&g)g=!1,I=!0,await S(300),i.click();else{g=!1;let e=document.querySelector(".ytp-popup.ytp-settings-menu");e&&(e.style.opacity="")}}function P(i,t){return i.hasAttribute(t)}async function at(){await S(100),I=!1;let i=[...document.querySelectorAll(".ytp-panel-menu > .ytp-menuitem")];if(i.length<1)return;i=_(i);let t=i[0];t&&((t==null?void 0:t.attributes["aria-checked"])===void 0?t.click():document.getElementsByClassName("ytp-settings-button")[0].click())}function ot(){const i={attributes:!0,childList:!0,subtree:!0},t=document.body;if(!t)return;new MutationObserver(function(s,n){s.forEach(async function(a){var d,f;const c=a.target;if(c.classList.contains("ytp-panel-menu")&&g&&(v&&clearTimeout(v),v=setTimeout(async()=>{await nt()},300)),c.classList.contains("ytp-panel-menu")&&I&&(v&&clearTimeout(v),v=setTimeout(async()=>{await at()},300)),a.target.nodeName.toLowerCase()==="ytd-watch-flexy"){const r=a.target,m=()=>P(r,"theater")&&M(a.target.baseURI),u=()=>P(r,"fullscreen")&&M(a.target.baseURI),N=()=>P(r,"hidden"),T=()=>r.hasAttribute("role")&&r.getAttribute("role")==="main";a.attributeName==="video-id"&&r.getAttribute("video-id")&&((d=document.querySelector("ytd-watch-flexy"))!=null&&d.hasAttribute("theater")||(f=document.querySelector("ytd-watch-flexy"))!=null&&f.hasAttribute("fullscreen"))&&!g&&localStorage.getItem("ytme-hq")==="true"&&await k(),(a.attributeName==="hidden"||a.attributeName==="role")&&(N()&&!T()?q():m()&&A(n,t,i)),a.attributeName==="theater"?m()?A(n,t,i):q():a.attributeName==="fullscreen"&&(u()?A(n,t,i):m()||q())}a.type==="attributes"&&a.target.nodeName==="VIDEO"&&a.attributeName!=="tabindex"&&M(a.target.baseURI)&&(L&&clearTimeout(L),L=setTimeout(async()=>{G(n),n.observe(t,i)},600))})}).observe(t,i)}ot();
