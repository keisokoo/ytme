var F=Object.defineProperty;var O=(i,e,t)=>e in i?F(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var n=(i,e,t)=>(O(i,typeof e!="symbol"?e+"":e,t),t);class R{constructor(e,t,s){n(this,"factor",.05);n(this,"minScale",.1);n(this,"maxScale",10);n(this,"ts",{scale:1,rotate:0,translate:{x:0,y:0}});n(this,"filter",{contrast:1,saturate:1,brightness:1});n(this,"loopTime",{start:null,end:null});n(this,"restrictPosition");n(this,"before");n(this,"after");n(this,"restrictXY",e=>{let{x:t,y:s}=e;if(!this.targetElement)return{x:t,y:s};if(!this.restrictPosition)return{x:t,y:s};const o=this.targetElement.getBoundingClientRect();return this.restrictPosition(e,o)});n(this,"decompose_2d_matrix",e=>{const{a:t,b:s,c:o,d:a,e:h,f:u}=e;let m=t*a-s*o,r={translation:[h,u],deg:0,rotation:0,scale:[0,0],skew:[0,0]};if(t!==0||s!==0){let c=Math.sqrt(t*t+s*s);r.rotation=s>0?Math.acos(t/c):-Math.acos(t/c),r.scale=[c,m/c],r.skew=[Math.atan((t*o+s*a)/(c*c)),0]}else if(o!==0||a!==0){let c=Math.sqrt(o*o+a*a);r.rotation=Math.PI/2-(a>0?Math.acos(-o/c):-Math.acos(o/c)),r.scale=[m/c,c],r.skew=[0,Math.atan((t*o+s*a)/(c*c))]}Math.abs(r.rotation)===0&&(r.rotation=0);const d=r.rotation*(180/Math.PI);return r.deg=d<0?d+360:d,{scale:r.scale[0],rotate:r.deg,translate:{x:r.translation[0],y:r.translation[1]}}});n(this,"isTranslateValues",e=>e!==void 0&&"translate"in e&&"rotate"in e&&"scale"in e);n(this,"isFilter",e=>e!==void 0&&"contrast"in e&&"brightness"in e&&"saturate"in e);n(this,"getPosition",e=>{const t=new WebKitCSSMatrix(window.getComputedStyle(e??this.targetElement).transform);return this.decompose_2d_matrix(t)});n(this,"updatePosition",e=>{this.isTranslateValues(e)?this.ts=e:this.ts=e(this.getPosition()),this.setTransform()});n(this,"loadTransform",()=>{const e=localStorage.getItem("ytf-transform"),t=localStorage.getItem("ytf-filter");if(e){const s=JSON.parse(e);this.isTranslateValues(s)&&(this.ts=s,this.setTransform())}if(t){const s=JSON.parse(t);this.isFilter(s)&&(this.filter=s,this.setFilter())}});n(this,"setTransform",()=>{this.before&&this.before(),localStorage.setItem("ytf-transform",JSON.stringify(this.ts)),this.targetElement.style.transform=`translate(${this.ts.translate.x}px,${this.ts.translate.y}px) scale(${this.ts.scale}) rotate(${this.ts.rotate}deg)`,this.after&&this.after()});n(this,"setFilter",()=>{this.before&&this.before(),localStorage.setItem("ytf-filter",JSON.stringify(this.filter)),Object.keys(this.filter).forEach(e=>{const t=document.querySelector(`.ytf-${e}`);t&&(t.textContent=String(Math.floor(this.filter[e]*100)/100))}),this.targetElement.style.filter=`contrast(${this.filter.contrast}) saturate(${this.filter.saturate}) brightness(${this.filter.brightness})`,this.after&&this.after()});n(this,"toggleRotation",e=>(e=Math.abs(e),e===0?90:e===90?180:e===180?270:0));this.targetElement=e,this.eventElement=t,s!=null&&s.factor&&(this.factor=s.factor),s!=null&&s.minScale&&(this.minScale=s.minScale),s!=null&&s.maxScale&&(this.maxScale=s.maxScale),s!=null&&s.before&&(this.before=s.before),s!=null&&s.after&&(this.after=s.after),s!=null&&s.restrictPosition&&(this.restrictPosition=s.restrictPosition)}}class H extends R{constructor(){super(...arguments);n(this,"inertiaAnimationFrame",-1);n(this,"isDrag",!1);n(this,"isScale",!1);n(this,"dragged",!1);n(this,"threshold",1);n(this,"startPoint",{x:0,y:0});n(this,"previousPosition",{x:0,y:0});n(this,"maximumInertia",40);n(this,"velocity",{x:0,y:0});n(this,"deceleration",.9);n(this,"startDist",0);n(this,"startScale",1);n(this,"capSpeed",t=>{let s=0;return Math.abs(t)>this.maximumInertia?(s=this.maximumInertia,s*=t<0?-1:1,s):t});n(this,"updateInertia",()=>{this.targetElement&&(this.velocity.x=this.velocity.x*this.deceleration,this.velocity.y=this.velocity.y*this.deceleration,this.velocity.x=Math.round(this.velocity.x*10)/10,this.velocity.y=Math.round(this.velocity.y*10)/10,this.ts.translate.x=Math.round(this.ts.translate.x+this.velocity.x),this.ts.translate.y=Math.round(this.ts.translate.y+this.velocity.y),this.setTransform(),(Math.floor(Math.abs(this.velocity.x))!==0||Math.floor(Math.abs(this.velocity.y))!==0)&&(this.inertiaAnimationFrame=requestAnimationFrame(this.updateInertia)))});n(this,"dragFinish",()=>{this.velocity={x:this.capSpeed(this.restrictXY(this.velocity).x),y:this.capSpeed(this.restrictXY(this.velocity).y)},(this.velocity.x!==0||this.velocity.y!==0)&&(this.inertiaAnimationFrame=requestAnimationFrame(this.updateInertia))})}}const P=[0,90,180,270],Q=i=>{const e=P.length-1;return i+1>e?0:P[i+1]};class I extends H{constructor(){super(...arguments);n(this,"isPlaying",!1);n(this,"bezelTimeout");n(this,"key",t=>{if(t.code==="KeyR"){this.ts=this.getPosition();const s=this.ts.rotate,o=P.findIndex(a=>a===s);this.ts={...this.ts,rotate:Q(o)},this.setTransform()}});n(this,"restore",()=>{this.ts={rotate:0,scale:1,translate:{x:0,y:0}},this.setTransform()});n(this,"on",t=>{const s=localStorage.getItem("ytme-move");if(!s||s==="false")return;const o=document.querySelector("video");if(o&&(this.isPlaying=!o.paused),t.button)return t.preventDefault!=null&&t.preventDefault(),t.stopPropagation!=null&&t.stopPropagation(),this.restore(),t.cancelBubble=!1,!1;this.ts=this.getPosition(),this.isTouchEvent(t)&&t.touches.length===2?(this.isDrag=!1,this.isScale=!0,this.startDist=Math.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY),this.startScale=this.ts.scale):(cancelAnimationFrame(this.inertiaAnimationFrame),this.isDrag=!0,this.isScale=!1,this.startPoint={x:this.isTouchEvent(t)?t.touches[0].pageX:t.pageX,y:this.isTouchEvent(t)?t.touches[0].pageY:t.pageY},this.previousPosition={x:this.ts.translate.x,y:this.ts.translate.y},this.velocity={x:0,y:0});const a=this.eventElement??this.targetElement;t.touches?(a.addEventListener("touchmove",this.onMove,{passive:!0}),a.addEventListener("touchend",this.onEnd)):(a.addEventListener("mousemove",this.onMove,{passive:!0}),a.addEventListener("mouseup",this.onEnd),a.addEventListener("mouseleave",this.onEnd))});n(this,"isTouchEvent",t=>"touches"in t);n(this,"onMove",t=>{if(!this.targetElement)return;let s=this.eventElement?this.eventElement.ontouchmove:this.targetElement.ontouchmove;if(this.targetElement.ontouchmove=null,this.isDrag&&(this.isTouchEvent(t)&&t.touches.length===1||!this.isTouchEvent(t))){const o=this.isTouchEvent(t)?t.touches[0].pageX:t.pageX,a=this.isTouchEvent(t)?t.touches[0].pageY:t.pageY,h=this.ts.translate.x,u=this.ts.translate.y,m=-1;if(this.ts.translate.x=this.previousPosition.x+m*(-o+this.startPoint.x),this.ts.translate.y=this.previousPosition.y+m*(-a+this.startPoint.y),this.ts.translate=this.restrictXY(this.ts.translate),this.setTransform(),this.velocity={x:this.ts.translate.x-h,y:this.ts.translate.y-u},Math.abs(this.previousPosition.x-this.ts.translate.x)>this.threshold||Math.abs(this.previousPosition.y-this.ts.translate.x)>this.threshold){this.dragged=!0,document.body&&document.body.setAttribute("ytme-hide","");const r=document.querySelector("video");r&&(clearTimeout(this.bezelTimeout),this.isPlaying?(r.onpause=null,r.onpause=()=>{r.paused&&r.play().then(()=>{r.paused&&r.play()}),r.onpause=null,this.bezelTimeout=setTimeout(()=>{document.body&&document.body.removeAttribute("ytme-hide")},350)}):(r.onplay=null,r.onplay=()=>{r.paused||r.pause(),r.onplay=null,this.bezelTimeout=setTimeout(()=>{document.body&&document.body.removeAttribute("ytme-hide")},350)}))}}else if(this.isScale&&this.isTouchEvent(t)&&t.touches.length===2){const o=t.touches[0],a=t.touches[1],h=Math.hypot(o.clientX-a.clientX,o.clientY-a.clientY);let u=this.targetElement.getBoundingClientRect(),m=((o.clientX+a.clientX)/2-u.left)/this.ts.scale,r=((o.clientY+a.clientY)/2-u.top)/this.ts.scale;const d={w:Math.round(u.width/this.ts.scale),h:Math.round(u.height/this.ts.scale)},c=Math.hypot(d.w*this.ts.scale,d.h*this.ts.scale),C=c*h/this.startDist/c*this.startScale,q=Math.min(Math.max(this.minScale,C),this.maxScale),S=q-this.ts.scale,v=(S>0,S/2);this.ts.translate.x+=-(m*v*2)+d.w*v,this.ts.translate.y+=-(r*v*2)+d.h*v,this.ts.translate=this.restrictXY(this.ts.translate),this.ts.scale=q,this.setTransform()}this.eventElement?this.eventElement.ontouchmove=s:this.targetElement.ontouchmove=s});n(this,"onEnd",t=>{const s=this.eventElement??this.targetElement;this.isTouchEvent(t)?(s.removeEventListener("touchmove",this.onMove),s.removeEventListener("touchend",this.onEnd)):(s.removeEventListener("mousemove",this.onMove),s.removeEventListener("mouseup",this.onEnd),s.removeEventListener("mouseleave",this.onEnd)),cancelAnimationFrame(this.inertiaAnimationFrame),this.dragged&&this.isDrag&&this.dragFinish(),this.dragged=!1,this.isDrag=!1,this.isScale=!1});n(this,"onWheel",t=>{const s=localStorage.getItem("ytme-move");if(!s||s==="false"||!this.targetElement)return;t.preventDefault(),this.ts=this.getPosition();let o=this.eventElement?this.eventElement.onwheel:this.targetElement.onwheel;this.targetElement.onwheel=null;let a=this.targetElement.getBoundingClientRect(),h=(t.clientX-a.left)/this.ts.scale,u=(t.clientY-a.top)/this.ts.scale,m=-t.deltaY;if(this.ts.scale===this.maxScale&&m>0)return;const r={w:Math.round(a.width/this.ts.scale),h:Math.round(a.height/this.ts.scale)},d=this.factor*this.ts.scale;this.ts.scale=m>0?this.ts.scale+d:this.ts.scale-d,this.ts.scale=Math.min(Math.max(this.minScale,this.ts.scale),this.maxScale);let c=m>0?d/2:-(d/2);this.ts.scale<=this.minScale&&m<0||(this.ts.translate.x+=-h*c*2+r.w*c,this.ts.translate.y+=-u*c*2+r.h*c,this.ts.translate=this.restrictXY(this.ts.translate),this.setTransform(),this.eventElement?this.eventElement.onwheel=o:this.targetElement.onwheel=o)})}}let p,g=!1,L=!1,l=null,x,y=null,f=null;const b=i=>new Promise(e=>setTimeout(e,i)),E=i=>/(.*?)(^|\/|v=)([a-z0-9_-]{11})(.*)?/gim.test(i??window.location.href),$=()=>document.body.setAttribute("ytme",""),z=()=>document.body.removeAttribute("ytme");async function N(){let i=document.querySelector("video");for(;!i;)await b(300),i=document.querySelector("video")}const V=["4320p","2880p","2160p","1440p","1080p","720p","480p","360p","240p","144p"];function _(i){const e=/(^\d.*)p/g,t=/\((.*[0-9])p/g;return i.filter(o=>{let a=o==null?void 0:o.innerText.trim();return!t.test(a)&&(V.some(h=>a.includes(h))||e.test(a))})}async function J(){var t;if(g=!0,localStorage.getItem("ytme-hq")!=="true")return;await N();let e=(t=document.getElementsByClassName("ytp-settings-button"))==null?void 0:t[0];await b(300),e&&e.click()}function W(i){i==null||i.disconnect(),l==null||l.loadTransform()}const X=()=>{const i=document.querySelectorAll(".ytme-btn");i.length>0&&i.forEach(e=>e.remove())},A=i=>{const e=document.createElement("button"),t=document.createElement("span");return e.classList.add("ytp-button"),e.classList.add("ytme-btn"),e.classList.add("ytme-text-btn"),t.innerText=i,e.appendChild(t),{button:e,span:t}},Y=i=>{const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS(null,"width","100%"),e.setAttributeNS(null,"height","100%"),e.setAttributeNS(null,"version","1.1"),e.setAttributeNS(null,"viewBox","0 0 36 36");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"fill","#ffffff"),t.setAttributeNS(null,"d",i);const s=document.createElement("button");return s.classList.add("ytp-button"),s.classList.add("ytme-btn"),e.appendChild(t),s.appendChild(e),s},B=(i,e)=>{localStorage.getItem(i)==="true"?e.classList.add("active"):e.classList.remove("active")},U=()=>{if(X(),!l)return;const i=Y("M20.673,16.932l4.276,-0c0.445,-0 0.802,-0.358 0.802,-0.803l0,-4.275c0,-0.325 -0.193,-0.619 -0.494,-0.742c-0.301,-0.124 -0.645,-0.058 -0.876,0.174l-1.389,1.389c-2.927,-2.889 -7.641,-2.879 -10.551,0.033c-2.922,2.924 -2.922,7.661 0,10.584c2.924,2.923 7.661,2.923 10.584,-0c0.417,-0.418 0.417,-1.096 -0,-1.514c-0.418,-0.417 -1.096,-0.417 -1.513,0c-2.088,2.088 -5.473,2.088 -7.561,0c-2.087,-2.088 -2.087,-5.472 0,-7.56c2.078,-2.078 5.436,-2.088 7.527,-0.033l-1.373,1.376c-0.231,0.231 -0.297,0.575 -0.173,0.876c0.123,0.301 0.417,0.495 0.741,0.495Z"),e=Y("M18.707,10.339c-0.391,-0.391 -1.026,-0.391 -1.417,0l-2,2.001c-0.288,0.287 -0.372,0.716 -0.216,1.091c0.156,0.375 0.519,0.619 0.925,0.619l1.001,-0l-0,3.001l-3.002,0l0,-1.003c0,-0.404 -0.243,-0.769 -0.619,-0.926c-0.375,-0.156 -0.803,-0.069 -1.091,0.216l-2.001,2.001c-0.39,0.391 -0.39,1.025 0,1.416l2.001,2.001c0.288,0.287 0.716,0.372 1.091,0.215c0.376,-0.156 0.619,-0.518 0.619,-0.925l0,-0.997l3.002,-0l-0,3.001l-1.001,0c-0.403,0 -0.769,0.244 -0.925,0.619c-0.156,0.375 -0.069,0.804 0.216,1.091l2,2.001c0.391,0.391 1.026,0.391 1.417,-0l2,-2.001c0.288,-0.287 0.372,-0.716 0.216,-1.091c-0.156,-0.375 -0.519,-0.619 -0.925,-0.619l-0.998,0l0,-3.001l3.002,-0l-0,1c-0,0.404 0.243,0.769 0.619,0.926c0.375,0.156 0.803,0.068 1.091,-0.216l2.001,-2.001c0.39,-0.391 0.39,-1.025 -0,-1.416l-2.001,-2.001c-0.288,-0.288 -0.716,-0.372 -1.091,-0.216c-0.376,0.157 -0.619,0.519 -0.619,0.926l-0,1l-3.002,0l0,-3.004l1.001,-0c0.403,-0 0.769,-0.244 0.925,-0.619c0.156,-0.375 0.069,-0.804 -0.216,-1.091l-2,-2.001l-0.003,0.003Z");l.ts=l.getPosition();const{button:t}=A("HQ"),{button:s,span:o}=A(l.ts.rotate+"°");B("ytme-hq",t),B("ytme-move",e),t.onclick=async a=>{a.stopPropagation();const h=localStorage.getItem("ytme-hq");!h||h==="false"?(localStorage.setItem("ytme-hq","true"),t.classList.add("active")):(localStorage.setItem("ytme-hq","false"),t.classList.remove("active"))},s.onclick=a=>{a.stopPropagation(),l.ts=l.getPosition(),l.ts={...l.ts,rotate:l.toggleRotation(l.ts.rotate)},o.innerText=l.ts.rotate+"°",l.setTransform()},i.onclick=a=>{a.stopPropagation(),o.innerText=0+"°",l.restore()},e.onclick=a=>{a.stopPropagation();const h=localStorage.getItem("ytme-move");!h||h==="false"?(localStorage.setItem("ytme-move","true"),e.classList.add("active")):(localStorage.setItem("ytme-move","false"),e.classList.remove("active"))},document.querySelector(".ytp-right-controls").prepend(t),document.querySelector(".ytp-right-controls").prepend(s),document.querySelector(".ytp-right-controls").prepend(e),document.querySelector(".ytp-right-controls").prepend(i)},k=()=>{document.querySelector("#masthead-container").classList.add("active")},D=()=>{document.querySelector("#masthead-container").classList.remove("active")},T=async(i,e,t)=>{if($(),await N(),f=document.querySelector("video:not(#video-preview-container video)"),f||(f=document.querySelector("video:not(#video-preview-container video)")),!y){if(!f||!f.parentElement)return;y=f.parentElement}l instanceof I||(l=new I(f,y,{before:()=>{i.disconnect()},after:()=>{i.observe(e,t)}}),document.querySelector("#masthead-container").addEventListener("mouseenter",k),f.addEventListener("mouseenter",D),f.addEventListener("mousedown",l.on),y.addEventListener("wheel",l.onWheel),U()),g||await J()},w=()=>{if(l){const i=document.querySelector("#masthead-container");i==null||i.removeEventListener("mouseenter",k),f==null||f.removeEventListener("mousedown",l.on),f==null||f.addEventListener("mouseenter",D),y==null||y.removeEventListener("wheel",l.onWheel),l=null}X(),z()};async function G(){var e;await b(100);const i=(e=document.querySelector(".ytp-panel-menu"))==null?void 0:e.lastChild;if(i&&g)g=!1,L=!0,i.click();else{let t=document.querySelector(".ytp-popup.ytp-settings-menu");t&&(t.style.opacity="")}}function M(i,e){return i.hasAttribute(e)}async function K(){L=!1,await b(100);let i=[...document.querySelectorAll(".ytp-panel-menu > .ytp-menuitem")];if(i.length<1)return;i=_(i);let e=i[0];e&&((e==null?void 0:e.attributes["aria-checked"])===void 0?e.click():document.getElementsByClassName("ytp-settings-button")[0].click())}function Z(){const i={attributes:!0,childList:!0,subtree:!0},e=document.body;if(!e)return;new MutationObserver(function(s,o){s.forEach(function(a){const h=a.target;if(h.classList.contains("ytp-panel-menu")&&g&&(p&&clearTimeout(p),p=setTimeout(async()=>{await G()},300)),h.classList.contains("ytp-panel-menu")&&L&&(p&&clearTimeout(p),p=setTimeout(async()=>{await K()},300)),a.target.nodeName.toLowerCase()==="ytd-watch-flexy"){const u=a.target,m=()=>M(u,"theater")&&E(a.target.baseURI),r=()=>M(u,"fullscreen")&&E(a.target.baseURI),d=()=>M(u,"hidden"),c=()=>u.hasAttribute("role")&&u.getAttribute("role")==="main";(a.attributeName==="hidden"||a.attributeName==="role")&&(d()&&!c()?w():m()&&T(o,e,i)),a.attributeName==="theater"?m()?T(o,e,i):w():a.attributeName==="fullscreen"&&(r()?T(o,e,i):m()||w())}a.type==="attributes"&&a.target.nodeName==="VIDEO"&&a.attributeName!=="tabindex"&&E(a.target.baseURI)&&(x&&clearTimeout(x),x=setTimeout(async()=>{W(o),o.observe(e,i)},600))})}).observe(e,i)}Z();
