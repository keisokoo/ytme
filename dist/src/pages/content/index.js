var O=Object.defineProperty;var R=(i,e,t)=>e in i?O(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var o=(i,e,t)=>(R(i,typeof e!="symbol"?e+"":e,t),t);class H{constructor(e,t,s){o(this,"factor",.05);o(this,"minScale",.1);o(this,"maxScale",10);o(this,"ts",{scale:1,rotate:0,translate:{x:0,y:0}});o(this,"filter",{contrast:1,saturate:1,brightness:1});o(this,"loopTime",{start:null,end:null});o(this,"restrictPosition");o(this,"before");o(this,"after");o(this,"restrictXY",e=>{let{x:t,y:s}=e;if(!this.targetElement)return{x:t,y:s};if(!this.restrictPosition)return{x:t,y:s};const a=this.targetElement.getBoundingClientRect();return this.restrictPosition(e,a)});o(this,"decompose_2d_matrix",e=>{const{a:t,b:s,c:a,d:n,e:h,f:d}=e;let u=t*n-s*a,r={translation:[h,d],deg:0,rotation:0,scale:[0,0],skew:[0,0]};if(t!==0||s!==0){let c=Math.sqrt(t*t+s*s);r.rotation=s>0?Math.acos(t/c):-Math.acos(t/c),r.scale=[c,u/c],r.skew=[Math.atan((t*a+s*n)/(c*c)),0]}else if(a!==0||n!==0){let c=Math.sqrt(a*a+n*n);r.rotation=Math.PI/2-(n>0?Math.acos(-a/c):-Math.acos(a/c)),r.scale=[u/c,c],r.skew=[0,Math.atan((t*a+s*n)/(c*c))]}Math.abs(r.rotation)===0&&(r.rotation=0);const y=r.rotation*(180/Math.PI);return r.deg=y<0?y+360:y,{scale:r.scale[0],rotate:r.deg,translate:{x:r.translation[0],y:r.translation[1]}}});o(this,"isTranslateValues",e=>e!==void 0&&"translate"in e&&"rotate"in e&&"scale"in e);o(this,"isFilter",e=>e!==void 0&&"contrast"in e&&"brightness"in e&&"saturate"in e);o(this,"getPosition",e=>{const t=new WebKitCSSMatrix(window.getComputedStyle(e??this.targetElement).transform);return this.decompose_2d_matrix(t)});o(this,"updatePosition",e=>{this.isTranslateValues(e)?this.ts=e:this.ts=e(this.getPosition()),this.setTransform()});o(this,"loadTransform",()=>{const e=localStorage.getItem("ytf-transform"),t=localStorage.getItem("ytf-filter");if(e){const s=JSON.parse(e);this.isTranslateValues(s)&&(this.ts=s,this.setTransform())}if(t){const s=JSON.parse(t);this.isFilter(s)&&(this.filter=s,this.setFilter())}});o(this,"setTransform",()=>{this.before&&this.before(),localStorage.setItem("ytf-transform",JSON.stringify(this.ts)),this.targetElement.style.transform=`translate(${this.ts.translate.x}px,${this.ts.translate.y}px) scale(${this.ts.scale}) rotate(${this.ts.rotate}deg)`,this.after&&this.after()});o(this,"setFilter",()=>{this.before&&this.before(),localStorage.setItem("ytf-filter",JSON.stringify(this.filter)),Object.keys(this.filter).forEach(e=>{const t=document.querySelector(`.ytf-${e}`);t&&(t.textContent=String(Math.floor(this.filter[e]*100)/100))}),this.targetElement.style.filter=`contrast(${this.filter.contrast}) saturate(${this.filter.saturate}) brightness(${this.filter.brightness})`,this.after&&this.after()});o(this,"toggleRotation",e=>(e=Math.abs(e),e===0?90:e===90?180:e===180?270:0));this.targetElement=e,this.eventElement=t,s!=null&&s.factor&&(this.factor=s.factor),s!=null&&s.minScale&&(this.minScale=s.minScale),s!=null&&s.maxScale&&(this.maxScale=s.maxScale),s!=null&&s.before&&(this.before=s.before),s!=null&&s.after&&(this.after=s.after),s!=null&&s.restrictPosition&&(this.restrictPosition=s.restrictPosition)}}class Q extends H{constructor(){super(...arguments);o(this,"inertiaAnimationFrame",-1);o(this,"isDrag",!1);o(this,"isScale",!1);o(this,"dragged",!1);o(this,"threshold",1);o(this,"startPoint",{x:0,y:0});o(this,"previousPosition",{x:0,y:0});o(this,"maximumInertia",40);o(this,"velocity",{x:0,y:0});o(this,"deceleration",.9);o(this,"startDist",0);o(this,"startScale",1);o(this,"capSpeed",t=>{let s=0;return Math.abs(t)>this.maximumInertia?(s=this.maximumInertia,s*=t<0?-1:1,s):t});o(this,"updateInertia",()=>{this.targetElement&&(this.velocity.x=this.velocity.x*this.deceleration,this.velocity.y=this.velocity.y*this.deceleration,this.velocity.x=Math.round(this.velocity.x*10)/10,this.velocity.y=Math.round(this.velocity.y*10)/10,this.ts.translate.x=Math.round(this.ts.translate.x+this.velocity.x),this.ts.translate.y=Math.round(this.ts.translate.y+this.velocity.y),this.setTransform(),(Math.floor(Math.abs(this.velocity.x))!==0||Math.floor(Math.abs(this.velocity.y))!==0)&&(this.inertiaAnimationFrame=requestAnimationFrame(this.updateInertia)))});o(this,"dragFinish",()=>{this.velocity={x:this.capSpeed(this.restrictXY(this.velocity).x),y:this.capSpeed(this.restrictXY(this.velocity).y)},(this.velocity.x!==0||this.velocity.y!==0)&&(this.inertiaAnimationFrame=requestAnimationFrame(this.updateInertia))})}}const M=[0,90,180,270],$=i=>{const e=M.length-1;return i+1>e?0:M[i+1]};class q extends Q{constructor(){super(...arguments);o(this,"isPlaying",!1);o(this,"bezelTimeout");o(this,"key",t=>{if(t.code==="KeyR"){this.ts=this.getPosition();const s=this.ts.rotate,a=M.findIndex(n=>n===s);this.ts={...this.ts,rotate:$(a)},this.setTransform()}});o(this,"restore",()=>{this.ts={rotate:0,scale:1,translate:{x:0,y:0}},this.setTransform()});o(this,"on",t=>{const s=localStorage.getItem("ytme-move");if(!s||s==="false")return;const a=document.querySelector("video");if(a&&(this.isPlaying=!a.paused),t.button)return t.preventDefault!=null&&t.preventDefault(),t.stopPropagation!=null&&t.stopPropagation(),this.restore(),t.cancelBubble=!1,!1;this.ts=this.getPosition(),this.isTouchEvent(t)&&t.touches.length===2?(this.isDrag=!1,this.isScale=!0,this.startDist=Math.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY),this.startScale=this.ts.scale):(cancelAnimationFrame(this.inertiaAnimationFrame),this.isDrag=!0,this.isScale=!1,this.startPoint={x:this.isTouchEvent(t)?t.touches[0].pageX:t.pageX,y:this.isTouchEvent(t)?t.touches[0].pageY:t.pageY},this.previousPosition={x:this.ts.translate.x,y:this.ts.translate.y},this.velocity={x:0,y:0});const n=this.eventElement??this.targetElement;t.touches?(n.addEventListener("touchmove",this.onMove,{passive:!0}),n.addEventListener("touchend",this.onEnd)):(n.addEventListener("mousemove",this.onMove,{passive:!0}),n.addEventListener("mouseup",this.onEnd),n.addEventListener("mouseleave",this.onEnd))});o(this,"isTouchEvent",t=>"touches"in t);o(this,"onMove",t=>{if(!this.targetElement)return;let s=this.eventElement?this.eventElement.ontouchmove:this.targetElement.ontouchmove;if(this.targetElement.ontouchmove=null,this.isDrag&&(this.isTouchEvent(t)&&t.touches.length===1||!this.isTouchEvent(t))){const a=this.isTouchEvent(t)?t.touches[0].pageX:t.pageX,n=this.isTouchEvent(t)?t.touches[0].pageY:t.pageY,h=this.ts.translate.x,d=this.ts.translate.y,u=-1;if(this.ts.translate.x=this.previousPosition.x+u*(-a+this.startPoint.x),this.ts.translate.y=this.previousPosition.y+u*(-n+this.startPoint.y),this.ts.translate=this.restrictXY(this.ts.translate),this.setTransform(),this.velocity={x:this.ts.translate.x-h,y:this.ts.translate.y-d},Math.abs(this.previousPosition.x-this.ts.translate.x)>this.threshold||Math.abs(this.previousPosition.y-this.ts.translate.x)>this.threshold){this.dragged=!0,document.body&&document.body.setAttribute("ytme-hide","");const r=document.querySelector("video");r&&(clearTimeout(this.bezelTimeout),this.isPlaying?(r.onpause=null,r.onpause=()=>{r.paused&&r.play().then(()=>{r.paused&&r.play()}),r.onpause=null,this.bezelTimeout=setTimeout(()=>{document.body&&document.body.removeAttribute("ytme-hide")},350)}):(r.onplay=null,r.onplay=()=>{r.paused||r.pause(),r.onplay=null,this.bezelTimeout=setTimeout(()=>{document.body&&document.body.removeAttribute("ytme-hide")},350)}))}}else if(this.isScale&&this.isTouchEvent(t)&&t.touches.length===2){const a=t.touches[0],n=t.touches[1],h=Math.hypot(a.clientX-n.clientX,a.clientY-n.clientY);let d=this.targetElement.getBoundingClientRect(),u=((a.clientX+n.clientX)/2-d.left)/this.ts.scale,r=((a.clientY+n.clientY)/2-d.top)/this.ts.scale;const y={w:Math.round(d.width/this.ts.scale),h:Math.round(d.height/this.ts.scale)},c=Math.hypot(y.w*this.ts.scale,y.h*this.ts.scale),F=c*h/this.startDist/c*this.startScale,L=Math.min(Math.max(this.minScale,F),this.maxScale),E=L-this.ts.scale,v=(E>0,E/2);this.ts.translate.x+=-(u*v*2)+y.w*v,this.ts.translate.y+=-(r*v*2)+y.h*v,this.ts.translate=this.restrictXY(this.ts.translate),this.ts.scale=L,this.setTransform()}this.eventElement?this.eventElement.ontouchmove=s:this.targetElement.ontouchmove=s});o(this,"onEnd",t=>{const s=this.eventElement??this.targetElement;this.isTouchEvent(t)?(s.removeEventListener("touchmove",this.onMove),s.removeEventListener("touchend",this.onEnd)):(s.removeEventListener("mousemove",this.onMove),s.removeEventListener("mouseup",this.onEnd),s.removeEventListener("mouseleave",this.onEnd)),cancelAnimationFrame(this.inertiaAnimationFrame),this.dragged&&this.isDrag&&this.dragFinish(),this.dragged=!1,this.isDrag=!1,this.isScale=!1});o(this,"onWheel",t=>{const s=localStorage.getItem("ytme-move");if(!s||s==="false"||!this.targetElement)return;t.preventDefault(),this.ts=this.getPosition();let a=this.eventElement?this.eventElement.onwheel:this.targetElement.onwheel;this.targetElement.onwheel=null;let n=this.targetElement.getBoundingClientRect(),h=(t.clientX-n.left)/this.ts.scale,d=(t.clientY-n.top)/this.ts.scale,u=-t.deltaY;if(this.ts.scale===this.maxScale&&u>0)return;const r={w:Math.round(n.width/this.ts.scale),h:Math.round(n.height/this.ts.scale)},y=this.factor*this.ts.scale;this.ts.scale=u>0?this.ts.scale+y:this.ts.scale-y,this.ts.scale=Math.min(Math.max(this.minScale,this.ts.scale),this.maxScale);let c=u>0?y/2:-(y/2);this.ts.scale<=this.minScale&&u<0||(this.ts.translate.x+=-h*c*2+r.w*c,this.ts.translate.y+=-d*c*2+r.h*c,this.ts.translate=this.restrictXY(this.ts.translate),this.setTransform(),this.eventElement?this.eventElement.onwheel=a:this.targetElement.onwheel=a)})}}let b,p,S=!1,g=!1,l=null,x,T,f=null,m=null;const P=i=>new Promise(e=>setTimeout(e,i)),w=i=>/(.*?)(^|\/|v=)([a-z0-9_-]{11})(.*)?/gim.test(i??window.location.href),z=()=>document.body.setAttribute("ytme",""),V=()=>document.body.removeAttribute("ytme");async function X(){let i=document.querySelector("video");for(;!i;)await P(300),i=document.querySelector("video")}const _=["4320p","2880p","2160p","1440p","1080p","720p","480p","360p","240p","144p"];function J(i){const e=/(^\d.*)p/g,t=/\((.*[0-9])p/g;return i.filter(a=>{let n=a==null?void 0:a.innerText.trim();return!t.test(n)&&(_.some(h=>n.includes(h))||e.test(n))})}async function W(){if(S=!0,localStorage.getItem("ytme-hq")!=="true")return;await X();let e=document.querySelector(".ytp-popup.ytp-settings-menu");e&&(e.style.opacity="0"),document.getElementsByClassName("ytp-settings-button")[0].click()}function G(i){i==null||i.disconnect(),l==null||l.loadTransform()}const k=()=>{const i=document.querySelectorAll(".ytme-btn");i.length>0&&i.forEach(e=>e.remove())},I=i=>{const e=document.createElement("button"),t=document.createElement("span");return e.classList.add("ytp-button"),e.classList.add("ytme-btn"),e.classList.add("ytme-text-btn"),t.innerText=i,e.appendChild(t),{button:e,span:t}},A=i=>{const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS(null,"width","100%"),e.setAttributeNS(null,"height","100%"),e.setAttributeNS(null,"version","1.1"),e.setAttributeNS(null,"viewBox","0 0 36 36");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"fill","#ffffff"),t.setAttributeNS(null,"d",i);const s=document.createElement("button");return s.classList.add("ytp-button"),s.classList.add("ytme-btn"),e.appendChild(t),s.appendChild(e),s},Y=(i,e)=>{localStorage.getItem(i)==="true"?e.classList.add("active"):e.classList.remove("active")},K=()=>{if(k(),!l)return;const i=A("M20.673,16.932l4.276,-0c0.445,-0 0.802,-0.358 0.802,-0.803l0,-4.275c0,-0.325 -0.193,-0.619 -0.494,-0.742c-0.301,-0.124 -0.645,-0.058 -0.876,0.174l-1.389,1.389c-2.927,-2.889 -7.641,-2.879 -10.551,0.033c-2.922,2.924 -2.922,7.661 0,10.584c2.924,2.923 7.661,2.923 10.584,-0c0.417,-0.418 0.417,-1.096 -0,-1.514c-0.418,-0.417 -1.096,-0.417 -1.513,0c-2.088,2.088 -5.473,2.088 -7.561,0c-2.087,-2.088 -2.087,-5.472 0,-7.56c2.078,-2.078 5.436,-2.088 7.527,-0.033l-1.373,1.376c-0.231,0.231 -0.297,0.575 -0.173,0.876c0.123,0.301 0.417,0.495 0.741,0.495Z"),e=A("M18.707,10.339c-0.391,-0.391 -1.026,-0.391 -1.417,0l-2,2.001c-0.288,0.287 -0.372,0.716 -0.216,1.091c0.156,0.375 0.519,0.619 0.925,0.619l1.001,-0l-0,3.001l-3.002,0l0,-1.003c0,-0.404 -0.243,-0.769 -0.619,-0.926c-0.375,-0.156 -0.803,-0.069 -1.091,0.216l-2.001,2.001c-0.39,0.391 -0.39,1.025 0,1.416l2.001,2.001c0.288,0.287 0.716,0.372 1.091,0.215c0.376,-0.156 0.619,-0.518 0.619,-0.925l0,-0.997l3.002,-0l-0,3.001l-1.001,0c-0.403,0 -0.769,0.244 -0.925,0.619c-0.156,0.375 -0.069,0.804 0.216,1.091l2,2.001c0.391,0.391 1.026,0.391 1.417,-0l2,-2.001c0.288,-0.287 0.372,-0.716 0.216,-1.091c-0.156,-0.375 -0.519,-0.619 -0.925,-0.619l-0.998,0l0,-3.001l3.002,-0l-0,1c-0,0.404 0.243,0.769 0.619,0.926c0.375,0.156 0.803,0.068 1.091,-0.216l2.001,-2.001c0.39,-0.391 0.39,-1.025 -0,-1.416l-2.001,-2.001c-0.288,-0.288 -0.716,-0.372 -1.091,-0.216c-0.376,0.157 -0.619,0.519 -0.619,0.926l-0,1l-3.002,0l0,-3.004l1.001,-0c0.403,-0 0.769,-0.244 0.925,-0.619c0.156,-0.375 0.069,-0.804 -0.216,-1.091l-2,-2.001l-0.003,0.003Z");l.ts=l.getPosition();const{button:t}=I("HQ"),{button:s,span:a}=I(l.ts.rotate+"°");Y("ytme-hq",t),Y("ytme-move",e),t.onclick=async n=>{n.stopPropagation();const h=localStorage.getItem("ytme-hq");!h||h==="false"?(localStorage.setItem("ytme-hq","true"),t.classList.add("active")):(localStorage.setItem("ytme-hq","false"),t.classList.remove("active"))},s.onclick=n=>{n.stopPropagation(),l.ts=l.getPosition(),l.ts={...l.ts,rotate:l.toggleRotation(l.ts.rotate)},a.innerText=l.ts.rotate+"°",l.setTransform()},i.onclick=n=>{n.stopPropagation(),a.innerText=0+"°",l.restore()},e.onclick=n=>{n.stopPropagation();const h=localStorage.getItem("ytme-move");!h||h==="false"?(localStorage.setItem("ytme-move","true"),e.classList.add("active")):(localStorage.setItem("ytme-move","false"),e.classList.remove("active"))},document.querySelector(".ytp-right-controls").prepend(t),document.querySelector(".ytp-right-controls").prepend(s),document.querySelector(".ytp-right-controls").prepend(e),document.querySelector(".ytp-right-controls").prepend(i)},C=()=>{document.querySelector("#masthead-container").classList.add("active")},N=()=>{document.querySelector("#masthead-container").classList.remove("active")},B=async(i,e,t)=>{if(z(),await X(),m=document.querySelector("video:not(#video-preview-container video)"),m||(m=document.querySelector("video:not(#video-preview-container video)")),!f){if(!m||!m.parentElement)return;f=m.parentElement}l instanceof q||(l=new q(m,f,{before:()=>{i.disconnect()},after:()=>{i.observe(e,t)}}),document.querySelector("#masthead-container").addEventListener("mouseenter",C),m.addEventListener("mouseenter",N),m.addEventListener("mousedown",l.on),f.addEventListener("wheel",l.onWheel),K()),await W()},D=()=>{if(l){const i=document.querySelector("#masthead-container");i==null||i.removeEventListener("mouseenter",C),m==null||m.removeEventListener("mousedown",l.on),m==null||m.addEventListener("mouseenter",N),f==null||f.removeEventListener("wheel",l.onWheel),l=null}k(),V()};async function U(){var e;await P(100);const i=(e=document.querySelector(".ytp-panel-menu"))==null?void 0:e.lastChild;if(i&&S)S=!1,g=!0,i.click();else{let t=document.querySelector(".ytp-popup.ytp-settings-menu");t&&(t.style.opacity="")}}async function Z(){await P(100);let i=[...document.querySelectorAll(".ytp-panel-menu > .ytp-menuitem")];i=J(i);let e=i[0];(e==null?void 0:e.attributes["aria-checked"])===void 0&&g?(g=!1,e.click()):(g=!1,document.getElementsByClassName("ytp-settings-button")[0].click());let t=document.querySelector(".ytp-popup.ytp-settings-menu");t&&(t.style.opacity="")}function j(){const i={attributes:!0,childList:!0,subtree:!0},e=document.body;if(!e)return;new MutationObserver(function(s,a){s.forEach(function(n){const h=n.target;h.classList.contains("ytp-panel-menu")&&S&&(p&&clearTimeout(p),p=setTimeout(async()=>{await U()},300)),h.classList.contains("ytp-panel-menu")&&g&&(p&&clearTimeout(p),p=setTimeout(async()=>{await Z()},300)),n.target.nodeName==="YTD-APP"&&(x&&clearTimeout(x),x=setTimeout(()=>{var u;w(n.target.baseURI)?(u=document.querySelector("#player-theater-container"))!=null&&u.firstChild&&B(a,e,i):D()},500)),n.type==="attributes"&&n.target.nodeName==="VIDEO"&&n.attributeName==="controlslist"&&w(n.target.baseURI)&&(T&&clearTimeout(T),T=setTimeout(async()=>{G(a),a.observe(e,i)},600));const d=n.target;n.type==="childList"&&d&&d.id==="player-theater-container"&&w()&&(n.addedNodes.length>0?n.previousSibling!==null&&(b&&clearTimeout(b),b=setTimeout(()=>{B(a,e,i)},300)):n.addedNodes.length===0&&n.removedNodes.length===1&&n.previousSibling===null&&D())})}).observe(e,i)}j();
