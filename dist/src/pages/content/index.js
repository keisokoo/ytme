var k=Object.defineProperty;var D=(i,e,t)=>e in i?k(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var o=(i,e,t)=>(D(i,typeof e!="symbol"?e+"":e,t),t);class F{constructor(e,t,s){o(this,"factor",.05);o(this,"minScale",.1);o(this,"maxScale",10);o(this,"ts",{scale:1,rotate:0,translate:{x:0,y:0}});o(this,"filter",{contrast:1,saturate:1,brightness:1});o(this,"loopTime",{start:null,end:null});o(this,"restrictPosition");o(this,"before");o(this,"after");o(this,"restrictXY",e=>{let{x:t,y:s}=e;if(!this.targetElement)return{x:t,y:s};if(!this.restrictPosition)return{x:t,y:s};const n=this.targetElement.getBoundingClientRect();return this.restrictPosition(e,n)});o(this,"decompose_2d_matrix",e=>{const{a:t,b:s,c:n,d:a,e:f,f:h}=e;let u=t*a-s*n,r={translation:[f,h],deg:0,rotation:0,scale:[0,0],skew:[0,0]};if(t!==0||s!==0){let c=Math.sqrt(t*t+s*s);r.rotation=s>0?Math.acos(t/c):-Math.acos(t/c),r.scale=[c,u/c],r.skew=[Math.atan((t*n+s*a)/(c*c)),0]}else if(n!==0||a!==0){let c=Math.sqrt(n*n+a*a);r.rotation=Math.PI/2-(a>0?Math.acos(-n/c):-Math.acos(n/c)),r.scale=[u/c,c],r.skew=[0,Math.atan((t*n+s*a)/(c*c))]}Math.abs(r.rotation)===0&&(r.rotation=0);const m=r.rotation*(180/Math.PI);return r.deg=m<0?m+360:m,{scale:r.scale[0],rotate:r.deg,translate:{x:r.translation[0],y:r.translation[1]}}});o(this,"isTranslateValues",e=>e!==void 0&&"translate"in e&&"rotate"in e&&"scale"in e);o(this,"isFilter",e=>e!==void 0&&"contrast"in e&&"brightness"in e&&"saturate"in e);o(this,"getPosition",e=>{const t=new WebKitCSSMatrix(window.getComputedStyle(e??this.targetElement).transform);return this.decompose_2d_matrix(t)});o(this,"updatePosition",e=>{this.isTranslateValues(e)?this.ts=e:this.ts=e(this.getPosition()),this.setTransform()});o(this,"loadTransform",()=>{const e=localStorage.getItem("ytf-transform"),t=localStorage.getItem("ytf-filter");if(e){const s=JSON.parse(e);this.isTranslateValues(s)&&(this.ts=s,this.setTransform())}if(t){const s=JSON.parse(t);this.isFilter(s)&&(this.filter=s,this.setFilter())}});o(this,"setTransform",()=>{this.before&&this.before(),localStorage.setItem("ytf-transform",JSON.stringify(this.ts)),this.targetElement.style.transform=`translate(${this.ts.translate.x}px,${this.ts.translate.y}px) scale(${this.ts.scale}) rotate(${this.ts.rotate}deg)`,this.after&&this.after()});o(this,"setFilter",()=>{this.before&&this.before(),localStorage.setItem("ytf-filter",JSON.stringify(this.filter)),Object.keys(this.filter).forEach(e=>{const t=document.querySelector(`.ytf-${e}`);t&&(t.textContent=String(Math.floor(this.filter[e]*100)/100))}),this.targetElement.style.filter=`contrast(${this.filter.contrast}) saturate(${this.filter.saturate}) brightness(${this.filter.brightness})`,this.after&&this.after()});o(this,"toggleRotation",e=>(e=Math.abs(e),e===0?90:e===90?180:e===180?270:0));this.targetElement=e,this.eventElement=t,s!=null&&s.factor&&(this.factor=s.factor),s!=null&&s.minScale&&(this.minScale=s.minScale),s!=null&&s.maxScale&&(this.maxScale=s.maxScale),s!=null&&s.before&&(this.before=s.before),s!=null&&s.after&&(this.after=s.after),s!=null&&s.restrictPosition&&(this.restrictPosition=s.restrictPosition)}}class O extends F{constructor(){super(...arguments);o(this,"inertiaAnimationFrame",-1);o(this,"isDrag",!1);o(this,"isScale",!1);o(this,"dragged",!1);o(this,"threshold",1);o(this,"startPoint",{x:0,y:0});o(this,"previousPosition",{x:0,y:0});o(this,"maximumInertia",40);o(this,"velocity",{x:0,y:0});o(this,"deceleration",.9);o(this,"startDist",0);o(this,"startScale",1);o(this,"capSpeed",t=>{let s=0;return Math.abs(t)>this.maximumInertia?(s=this.maximumInertia,s*=t<0?-1:1,s):t});o(this,"updateInertia",()=>{this.targetElement&&(this.velocity.x=this.velocity.x*this.deceleration,this.velocity.y=this.velocity.y*this.deceleration,this.velocity.x=Math.round(this.velocity.x*10)/10,this.velocity.y=Math.round(this.velocity.y*10)/10,this.ts.translate.x=Math.round(this.ts.translate.x+this.velocity.x),this.ts.translate.y=Math.round(this.ts.translate.y+this.velocity.y),this.setTransform(),(Math.floor(Math.abs(this.velocity.x))!==0||Math.floor(Math.abs(this.velocity.y))!==0)&&(this.inertiaAnimationFrame=requestAnimationFrame(this.updateInertia)))});o(this,"dragFinish",()=>{this.velocity={x:this.capSpeed(this.restrictXY(this.velocity).x),y:this.capSpeed(this.restrictXY(this.velocity).y)},(this.velocity.x!==0||this.velocity.y!==0)&&(this.inertiaAnimationFrame=requestAnimationFrame(this.updateInertia))})}}const M=[0,90,180,270],R=i=>{const e=M.length-1;return i+1>e?0:M[i+1]};class I extends O{constructor(){super(...arguments);o(this,"isPlaying",!1);o(this,"bezelTimeout");o(this,"key",t=>{if(t.code==="KeyR"){this.ts=this.getPosition();const s=this.ts.rotate,n=M.findIndex(a=>a===s);this.ts={...this.ts,rotate:R(n)},this.setTransform()}});o(this,"hasTransformed",()=>this.ts.rotate!==0||this.ts.scale!==1||this.ts.translate.x!==0||this.ts.translate.y!==0);o(this,"restore",()=>{this.ts={rotate:0,scale:1,translate:{x:0,y:0}},this.setTransform()});o(this,"on",t=>{const s=localStorage.getItem("ytme-move");if(!s||s==="false")return;const n=document.querySelector("video");if(n&&(this.isPlaying=!n.paused),t.button)return t.preventDefault!=null&&t.preventDefault(),t.stopPropagation!=null&&t.stopPropagation(),this.restore(),t.cancelBubble=!1,!1;this.ts=this.getPosition(),this.isTouchEvent(t)&&t.touches.length===2?(this.isDrag=!1,this.isScale=!0,this.startDist=Math.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY),this.startScale=this.ts.scale):(cancelAnimationFrame(this.inertiaAnimationFrame),this.isDrag=!0,this.isScale=!1,this.startPoint={x:this.isTouchEvent(t)?t.touches[0].pageX:t.pageX,y:this.isTouchEvent(t)?t.touches[0].pageY:t.pageY},this.previousPosition={x:this.ts.translate.x,y:this.ts.translate.y},this.velocity={x:0,y:0});const a=this.eventElement??this.targetElement;t.touches?(a.addEventListener("touchmove",this.onMove,{passive:!0}),a.addEventListener("touchend",this.onEnd)):(a.addEventListener("mousemove",this.onMove,{passive:!0}),a.addEventListener("mouseup",this.onEnd),a.addEventListener("mouseleave",this.onEnd))});o(this,"isTouchEvent",t=>"touches"in t);o(this,"onMove",t=>{if(!this.targetElement)return;let s=this.eventElement?this.eventElement.ontouchmove:this.targetElement.ontouchmove;if(this.targetElement.ontouchmove=null,this.isDrag&&(this.isTouchEvent(t)&&t.touches.length===1||!this.isTouchEvent(t))){const n=this.isTouchEvent(t)?t.touches[0].pageX:t.pageX,a=this.isTouchEvent(t)?t.touches[0].pageY:t.pageY,f=this.ts.translate.x,h=this.ts.translate.y,u=-1;if(this.ts.translate.x=this.previousPosition.x+u*(-n+this.startPoint.x),this.ts.translate.y=this.previousPosition.y+u*(-a+this.startPoint.y),this.ts.translate=this.restrictXY(this.ts.translate),this.setTransform(),this.velocity={x:this.ts.translate.x-f,y:this.ts.translate.y-h},Math.abs(this.previousPosition.x-this.ts.translate.x)>this.threshold||Math.abs(this.previousPosition.y-this.ts.translate.x)>this.threshold){this.dragged=!0,document.body&&document.body.setAttribute("ytme-hide","");const r=document.querySelector("video");r&&(clearTimeout(this.bezelTimeout),this.isPlaying?(r.onpause=null,r.onpause=()=>{r.paused&&r.play().then(()=>{r.paused&&r.play()}),r.onpause=null,this.bezelTimeout=setTimeout(()=>{document.body&&document.body.removeAttribute("ytme-hide")},350)}):(r.onplay=null,r.onplay=()=>{r.paused||r.pause(),r.onplay=null,this.bezelTimeout=setTimeout(()=>{document.body&&document.body.removeAttribute("ytme-hide")},350)}))}}else if(this.isScale&&this.isTouchEvent(t)&&t.touches.length===2){const n=t.touches[0],a=t.touches[1],f=Math.hypot(n.clientX-a.clientX,n.clientY-a.clientY);let h=this.targetElement.getBoundingClientRect(),u=((n.clientX+a.clientX)/2-h.left)/this.ts.scale,r=((n.clientY+a.clientY)/2-h.top)/this.ts.scale;const m={w:Math.round(h.width/this.ts.scale),h:Math.round(h.height/this.ts.scale)},c=Math.hypot(m.w*this.ts.scale,m.h*this.ts.scale),X=c*f/this.startDist/c*this.startScale,q=Math.min(Math.max(this.minScale,X),this.maxScale),S=q-this.ts.scale,v=(S>0,S/2);this.ts.translate.x+=-(u*v*2)+m.w*v,this.ts.translate.y+=-(r*v*2)+m.h*v,this.ts.translate=this.restrictXY(this.ts.translate),this.ts.scale=q,this.setTransform()}this.eventElement?this.eventElement.ontouchmove=s:this.targetElement.ontouchmove=s});o(this,"onEnd",t=>{const s=this.eventElement??this.targetElement;this.isTouchEvent(t)?(s.removeEventListener("touchmove",this.onMove),s.removeEventListener("touchend",this.onEnd)):(s.removeEventListener("mousemove",this.onMove),s.removeEventListener("mouseup",this.onEnd),s.removeEventListener("mouseleave",this.onEnd)),cancelAnimationFrame(this.inertiaAnimationFrame),this.dragged&&this.isDrag&&this.dragFinish(),this.dragged=!1,this.isDrag=!1,this.isScale=!1});o(this,"onWheel",t=>{const s=localStorage.getItem("ytme-move");if(!s||s==="false"||!this.targetElement)return;t.preventDefault(),this.ts=this.getPosition();let n=this.eventElement?this.eventElement.onwheel:this.targetElement.onwheel;this.targetElement.onwheel=null;let a=this.targetElement.getBoundingClientRect(),f=(t.clientX-a.left)/this.ts.scale,h=(t.clientY-a.top)/this.ts.scale,u=-t.deltaY;if(this.ts.scale===this.maxScale&&u>0)return;const r={w:Math.round(a.width/this.ts.scale),h:Math.round(a.height/this.ts.scale)},m=this.factor*this.ts.scale;this.ts.scale=u>0?this.ts.scale+m:this.ts.scale-m,this.ts.scale=Math.min(Math.max(this.minScale,this.ts.scale),this.maxScale);let c=u>0?m/2:-(m/2);this.ts.scale<=this.minScale&&u<0||(this.ts.translate.x+=-f*c*2+r.w*c,this.ts.translate.y+=-h*c*2+r.h*c,this.ts.translate=this.restrictXY(this.ts.translate),this.setTransform(),this.eventElement?this.eventElement.onwheel=n:this.targetElement.onwheel=n)})}}let p,g=!1,P=!1,l=null,E,y=null,d=null;const b=i=>new Promise(e=>setTimeout(e,i)),x=i=>/(.*?)(^|\/|v=)([a-z0-9_-]{11})(.*)?/gim.test(i??window.location.href),H=()=>document.body.setAttribute("ytme",""),$=()=>document.body.removeAttribute("ytme");async function A(){let i=document.querySelector("video");for(;!i;)await b(300),i=document.querySelector("video")}const z=["4320p","2880p","2160p","1440p","1080p","720p","480p","360p","240p","144p"];function Q(i){const e=/(^\d.*)p/g,t=/\((.*[0-9])p/g;return i.filter(n=>{let a=n==null?void 0:n.innerText.trim();return!t.test(a)&&(z.some(f=>a.includes(f))||e.test(a))})}async function Y(){var t;if(g=!0,localStorage.getItem("ytme-hq")!=="true")return;await A();let e=(t=document.getElementsByClassName("ytp-settings-button"))==null?void 0:t[0];await b(300),e&&e.click()}function V(i){i==null||i.disconnect(),l==null||l.loadTransform()}const B=()=>{const i=document.querySelectorAll(".ytme-btn");i.length>0&&i.forEach(e=>e.remove())},_=i=>{const e=document.createElement("button"),t=document.createElement("span");return e.classList.add("ytp-button"),e.classList.add("ytme-btn"),e.classList.add("ytme-text-btn"),t.innerText=i,e.appendChild(t),{button:e,span:t}},J=(i,e)=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttributeNS(null,"width","100%"),t.setAttributeNS(null,"height","100%"),t.setAttributeNS(null,"version","1.1"),t.setAttributeNS(null,"viewBox","0 0 36 36");const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"fill","#ffffff"),s.setAttributeNS(null,"d",i);const n=document.createElement("button");return n.classList.add("ytp-button"),n.classList.add("ytme-btn"),e&&n.classList.add(e),t.appendChild(s),n.appendChild(t),n},W=(i,e)=>{localStorage.getItem(i)==="true"?e.classList.add("active"):e.classList.remove("active")},U=i=>{i.stopPropagation();const e=i.target;if(!e)return;const t=e.getAttribute("data-value");if(t){if(t==="rotate"&&(l.ts=l.getPosition(),l.ts={...l.ts,rotate:l.toggleRotation(l.ts.rotate)},e.innerText=`Rotate: ${l.ts.rotate+"°"}`,l.setTransform()),t==="hq"){const s=localStorage.getItem("ytme-hq");!s||s==="false"?(localStorage.setItem("ytme-hq","true"),e.classList.add("active")):(localStorage.setItem("ytme-hq","false"),e.classList.remove("active"))}if(t==="transform"){const s=localStorage.getItem("ytme-move");!s||s==="false"?(localStorage.setItem("ytme-move","true"),e.classList.add("active")):(localStorage.setItem("ytme-move","false"),e.classList.remove("active"))}}},G=()=>{const i=document.createElement("div");i.classList.add("ytme-option-list"),l.ts=l.getPosition();const e=localStorage.getItem("ytme-move")==="true",t=localStorage.getItem("ytme-hq")==="true";return i.innerHTML=`
  <div class="option-nav">
  <div class="option-item" data-value="rotate">Rotate: ${l.ts.rotate+"°"}</div>
  <div class="option-item${e?" active":""}" data-value="transform">Transform<div class="ytme-ball"></div></div>
  <div class="option-item${t?" active":""}" data-value="hq">Force High Quality<div class="ytme-ball"></div></div>
    </div>
  `,i},K=()=>{if(B(),!l)return;const i=J("M20.673,16.932l4.276,-0c0.445,-0 0.802,-0.358 0.802,-0.803l0,-4.275c0,-0.325 -0.193,-0.619 -0.494,-0.742c-0.301,-0.124 -0.645,-0.058 -0.876,0.174l-1.389,1.389c-2.927,-2.889 -7.641,-2.879 -10.551,0.033c-2.922,2.924 -2.922,7.661 0,10.584c2.924,2.923 7.661,2.923 10.584,-0c0.417,-0.418 0.417,-1.096 -0,-1.514c-0.418,-0.417 -1.096,-0.417 -1.513,0c-2.088,2.088 -5.473,2.088 -7.561,0c-2.087,-2.088 -2.087,-5.472 0,-7.56c2.078,-2.078 5.436,-2.088 7.527,-0.033l-1.373,1.376c-0.231,0.231 -0.297,0.575 -0.173,0.876c0.123,0.301 0.417,0.495 0.741,0.495Z","ytme-restore");l.ts=l.getPosition();const{button:e}=_("YT"),t=l.hasTransformed();W("ytme-options",e),e.onclick=s=>{if(e.querySelector(".ytme-option-list"))e.classList.remove("active"),e.querySelector(".ytme-option-list").remove();else{e.classList.add("active");const n=G(),a=document.querySelector(".ytp-chrome-controls");n.style.bottom=a.clientHeight+"px";const f=e.getBoundingClientRect();n.style.left=f.left+"px",[...n.children].forEach(u=>u.addEventListener("click",U)),e.prepend(n)}},console.log("hasTransformed1",t),t&&i.classList.add("hide"),i.onclick=s=>{s.stopPropagation(),l.restore()},document.querySelector(".ytp-right-controls").prepend(e),document.querySelector(".ytp-right-controls").prepend(i)},N=()=>{document.querySelector("#masthead-container").classList.add("active")},C=()=>{document.querySelector("#masthead-container").classList.remove("active")},T=async(i,e,t)=>{if(H(),await A(),d=document.querySelector("video:not(#video-preview-container video)"),d||(d=document.querySelector("video:not(#video-preview-container video)")),!y){if(!d||!d.parentElement)return;y=d.parentElement}l instanceof I||(l=new I(d,y,{before:()=>{i.disconnect()},after:()=>{const n=l.hasTransformed(),a=document.querySelector(".ytme-restore");console.log("hasTransformed",n),console.log("restoreBtn",a),n?a&&a.classList.remove("hide"):a&&a.classList.add("hide"),i.observe(e,t)}}),document.querySelector("#masthead-container").addEventListener("mouseenter",N),d.addEventListener("mouseenter",C),d.addEventListener("mousedown",l.on),y.addEventListener("wheel",l.onWheel),K()),g||await Y()},w=()=>{if(l){const i=document.querySelector("#masthead-container");i==null||i.removeEventListener("mouseenter",N),d==null||d.removeEventListener("mousedown",l.on),d==null||d.addEventListener("mouseenter",C),y==null||y.removeEventListener("wheel",l.onWheel),l=null}B(),$()};async function j(){var e;await b(100);const i=(e=document.querySelector(".ytp-panel-menu"))==null?void 0:e.lastChild;if(i&&g)g=!1,P=!0,i.click();else{let t=document.querySelector(".ytp-popup.ytp-settings-menu");t&&(t.style.opacity="")}}function L(i,e){return i.hasAttribute(e)}async function Z(){P=!1,await b(100);let i=[...document.querySelectorAll(".ytp-panel-menu > .ytp-menuitem")];if(i.length<1)return;i=Q(i);let e=i[0];e&&((e==null?void 0:e.attributes["aria-checked"])===void 0?e.click():document.getElementsByClassName("ytp-settings-button")[0].click())}function tt(){const i={attributes:!0,childList:!0,subtree:!0},e=document.body;if(!e)return;new MutationObserver(function(s,n){s.forEach(function(a){const f=a.target;if(f.classList.contains("ytp-panel-menu")&&g&&(p&&clearTimeout(p),p=setTimeout(async()=>{await j()},300)),f.classList.contains("ytp-panel-menu")&&P&&(p&&clearTimeout(p),p=setTimeout(async()=>{await Z()},300)),a.target.nodeName.toLowerCase()==="ytd-watch-flexy"){const h=a.target,u=()=>L(h,"theater")&&x(a.target.baseURI),r=()=>L(h,"fullscreen")&&x(a.target.baseURI),m=()=>L(h,"hidden"),c=()=>h.hasAttribute("role")&&h.getAttribute("role")==="main";a.attributeName==="video-id"&&h.getAttribute("video-id")&&(g||Y()),(a.attributeName==="hidden"||a.attributeName==="role")&&(m()&&!c()?w():u()&&T(n,e,i)),a.attributeName==="theater"?u()?T(n,e,i):w():a.attributeName==="fullscreen"&&(r()?T(n,e,i):u()||w())}a.type==="attributes"&&a.target.nodeName==="VIDEO"&&a.attributeName!=="tabindex"&&x(a.target.baseURI)&&(E&&clearTimeout(E),E=setTimeout(async()=>{V(n),n.observe(e,i)},600))})}).observe(e,i)}tt();
